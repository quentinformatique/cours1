-- 1.
CREATE VIEW qcostes.acteur AS 
SELECT nom, prenom, titre
FROM qcostes.personne
INNER JOIN qcostes.jouer
ON personne.idPersonne = jouer.idActeur
INNER JOIN qcostes.film
ON jouer.idFilm = film.idFilm;

-- 2.
CREATE VIEW qcostes.realisateur AS
SELECT nom, prenom, titre
FROM qcostes.personne 
INNER JOIN qcostes.film
ON personne.idPersonne = film.idRealisateur;

-- 3.
CREATE VIEW qcostes.film_projection AS
SELECT film.titre, projection.jour, cinema.nom
FROM qcostes.film
INNER JOIN qcostes.projection
ON film.idFilm = projection.idFilm
INNER JOIN qcostes.cinema
ON projection.idCinema = cinema.idCinema;

-- 4.
CREATE USER qcostes_user1
IDENTIFIED BY 'user1';
CREATE USER qcostes_user2
IDENTIFIED BY 'user2';
CREATE USER qcostes_user3
IDENTIFIED BY 'user3';

-- 5.
GRANT SELECT ON qcostes.acteur TO qcostes_user1;
GRANT SELECT ON qcostes.realisateur TO qcostes_user2;
GRANT SELECT ON qcostes.film_projection TO qcostes_user3;

-- 6.
SHOW GRANTS FOR qcostes_user1;
SHOW GRANTS FOR qcostes_user2; 
SHOW GRANTS FOR qcostes_user3; 

-- 7.
-- user1
SHOW GRANTS;
SELECT * FROM acteur;

-- user2
SHOW GRANTS;
SELECT * FROM realisateur;

-- user3
SHOW GRANTS;
SELECT * FROM film_projection;

-- 8.
REVOKE SELECT ON qcostes.acteur FROM qcostes_user1;
REVOKE SELECT ON qcostes.realisateur FROM qcostes_user2;
REVOKE SELECT ON qcostes.film_projection FROM qcostes_user3;

-- 9.
CREATE ROLE qcostes_role1;
CREATE ROLE qcostes_role2;
CREATE ROLE qcostes_role3;


--  10.
GRANT SELECT ON qcostes.acteur TO qcostes_role1;
GRANT SELECT ON qcostes.realisateur TO qcostes_role2;
GRANT SELECT ON qcostes.film_projection TO qcostes_role3;

-- 11.
GRANT qcostes_role1 TO qcostes_user1;
GRANT qcostes_role2 TO qcostes_user2;
GRANT qcostes_role3 TO qcostes_user3;
SET DEFAULT ROLE qcostes_role1 FOR qcostes_user1;
SET DEFAULT ROLE qcostes_role2 FOR qcostes_user2;
SET DEFAULT ROLE qcostes_role3 FOR qcostes_user3;


-- 12.
-- user1
SHOW GRANTS;
SELECT * FROM acteur;

-- user2
SHOW GRANTS;
SELECT * FROM realisateur;

-- user3
SHOW GRANTS;
SELECT * FROM film_projection;

-- 13.
REVOKE SELECT ON qcostes.acteur FROM qcostes_role1;
REVOKE SELECT ON qcostes.realisateur FROM qcostes_role2;
REVOKE SELECT ON qcostes.film_projection FROM qcostes_role3;

GRANT SELECT ON qcostes.realisateur TO qcostes_role1;

GRANT SELECT ON qcostes.film_projection TO qcostes_role2;

GRANT qcostes_role1 TO qcostes_role3;
GRANT qcostes_role2 TO qcostes_role3;

-- 14.
SHOW GRANTS;
SELECT * FROM realisateur;

SHOW GRANTS;
SELECT * FROM film_projection;

SHOW GRANTS;
SELECT * FROM realisateur;
SELECT * FROM film_projection;

-- 15.
DROP ROLE qcostes_role1;
DROP ROLE qcostes_role2;
DROP ROLE qcostes_role3;

DROP USER qcostes_user1;
DROP USER qcostes_user2;
DROP USER qcostes_user3;

-- test:
SELECT user, is_role FROM mysql.user
WHERE user LIKE 'qcostes%';

